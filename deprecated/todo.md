# TODO - Future Improvements

## レビューカウント最適化

### 課題
hook-handlerでレビューカウントをチェックして、リミットに達している場合はgeminiを起動しないようにしたい。
これにより、無駄なgemini API呼び出しを避けることができる。

### 現在の問題点
- hook-handlerとcc-gc-review間でレビューカウントの上限値（MAX_REVIEWS）を共有する方法が限られている
- 中間ファイルを使う方法しか思いつかないが、複雑性が増す
- 環境変数での共有も可能だが、設定の一貫性を保つのが困難

### 検討すべきアプローチ
1. **設定ファイル方式**: 共通の設定ファイル（JSON/YAML）を使ってMAX_REVIEWSを共有
2. **環境変数方式**: CC_GC_REVIEW_MAX_REVIEWSなどの環境変数で設定を統一
3. **引数渡し方式**: hook-handlerの呼び出し時にMAX_REVIEWSを引数として渡す
4. **状態ファイル方式**: カウントファイルに上限値も含めて保存

### 優先度
- 中優先度
- gemini API呼び出しコストの削減とパフォーマンス向上が期待できる
- ただし、実装の複雑性とのトレードオフを検討する必要がある

## 完了した改善（Geminiレビュー結果）

### レビューカウント機能の強化 ✅
- [x] 不正なカウント値の検証と範囲チェック（0-9999）
- [x] アトミックなファイル操作によるカウント更新
- [x] --resendオプション使用時のカウント制限処理
- [x] ゼロ上限値（MAX_REVIEWS=0）での適切な動作
- [x] エッジケースのテストカバレッジ追加

### セキュリティとロバストネス ✅
- [x] 一時ファイルの安全な作成と削除
- [x] ファイル競合状態の回避
- [x] エラー状態での適切なリカバリ

### テスト環境管理の改善 ✅
- [x] test-tmp-* 固定名ディレクトリの廃止
- [x] mktemp -d による安全な一時ディレクトリ作成
- [x] trap を使用した確実なクリーンアップ機能
- [x] 全テストファイルでの統一的なクリーンアップ関数
- [x] テストランナーでの包括的なクリーンアップ処理

## その他の改善案

### テストカバレッジの向上
- [ ] inotifywait/fswatchを使った監視パスのテスト追加
- [ ] 一時ファイルの安全性テスト
- [ ] 同時並行処理のストレステスト

### ドキュメンテーション
- [ ] セキュリティ改善についてのREADME更新
- [ ] 新しいレビューカウント仕様の説明追加
- [ ] エラーハンドリングのベストプラクティス文書化